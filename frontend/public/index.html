<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Sistema de Control de Tableros" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Tablero de Control</title>
    
    <!-- üîß SCRIPT DE DETECCI√ìN Y LIMPIEZA AUTOM√ÅTICA DE CACHE -->
    <script>
      (function() {
        console.log('üîß Iniciando detecci√≥n de cache...');
        
        // Detectar si estamos en producci√≥n
        const isProduction = window.location.hostname !== 'localhost';
        
        if (isProduction) {
          console.log('üåê Detectado entorno de producci√≥n');
          
          // Verificar si hay problemas de cache
          const hasCacheIssues = localStorage.getItem('cache_cleared') !== 'true' || 
                                sessionStorage.getItem('cache_cleared') !== 'true';
          
          if (hasCacheIssues) {
            console.log('‚ö†Ô∏è Detectados problemas de cache, iniciando limpieza...');
            
            // Mostrar mensaje de limpieza
            document.body.innerHTML = `
              <div style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                color: white;
                font-family: Arial, sans-serif;
                z-index: 9999;
              ">
                <div style="text-align: center; padding: 20px;">
                  <h1 style="font-size: 2.5em; margin-bottom: 20px;">üîÑ Limpiando Cache...</h1>
                  <div style="font-size: 1.2em; margin-bottom: 30px;">
                    <p>Detectamos que necesitas una limpieza de cache.</p>
                    <p>Esto tomar√° unos segundos...</p>
                  </div>
                  <div style="
                    width: 50px;
                    height: 50px;
                    border: 5px solid rgba(255,255,255,0.3);
                    border-top: 5px solid white;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                    margin: 0 auto;
                  "></div>
                </div>
              </div>
              <style>
                @keyframes spin {
                  0% { transform: rotate(0deg); }
                  100% { transform: rotate(360deg); }
                }
              </style>
            `;
            
            // Limpiar todo el cache
            setTimeout(() => {
              // Limpiar localStorage y sessionStorage
              localStorage.clear();
              sessionStorage.clear();
              
              // Marcar como limpiado
              localStorage.setItem('cache_cleared', 'true');
              sessionStorage.setItem('cache_cleared', 'true');
              
              // Limpiar cache del navegador
              if ('caches' in window) {
                caches.keys().then(names => {
                  names.forEach(name => {
                    caches.delete(name);
                  });
                });
              }
              
              // Desregistrar service worker
              if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                  registrations.forEach(registration => {
                    registration.unregister();
                  });
                });
              }
              
              // Forzar recarga con par√°metros de cache busting
              setTimeout(() => {
                const timestamp = new Date().getTime();
                const newUrl = window.location.href.split('?')[0] + '?v=' + timestamp + '&cache_cleared=true';
                window.location.href = newUrl;
              }, 2000);
              
            }, 1000);
            
            return; // No cargar React hasta que se limpie el cache
          }
        }
        
        console.log('‚úÖ Cache verificado, cargando aplicaci√≥n...');
      })();
    </script>
    
    <!-- üîß INTERCEPTOR GLOBAL DE FETCH/XHR -->
    <script>
      (function() {
        const originalFetch = window.fetch;
        const originalXHROpen = XMLHttpRequest.prototype.open;
        
        // Interceptar fetch
        window.fetch = function(url, options) {
          if (typeof url === 'string' && url.includes('localhost:5001')) {
            const newUrl = url.replace('http://localhost:5001', 'https://tablero-control-1.onrender.com');
            console.log('üîÑ Fetch interceptado:', url, '‚Üí', newUrl);
            return originalFetch(newUrl, options);
          }
          return originalFetch(url, options);
        };
        
        // Interceptar XMLHttpRequest
        XMLHttpRequest.prototype.open = function(method, url, ...args) {
          if (typeof url === 'string' && url.includes('localhost:5001')) {
            const newUrl = url.replace('http://localhost:5001', 'https://tablero-control-1.onrender.com');
            console.log('üîÑ XHR interceptado:', url, '‚Üí', newUrl);
            return originalXHROpen.call(this, method, newUrl, ...args);
          }
          return originalXHROpen.call(this, method, url, ...args);
        };
        
        console.log('üîß Interceptores de red configurados');
      })();
    </script>
  </head>
  <body>
    <noscript>Necesitas habilitar JavaScript para ejecutar esta aplicaci√≥n.</noscript>
    <div id="root"></div>
  </body>
</html>
