<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Tablero de Control - Sistema de Gesti√≥n"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Tablero de Control</title>
    
    <!-- Script de control de versiones y cache busting -->
    <script>
      // Versi√≥n de la aplicaci√≥n para cache busting
      window.APP_VERSION = '3.0.0-' + Date.now();
      
      // Detectar si viene de limpieza nuclear o emergencia
      const urlParams = new URLSearchParams(window.location.search);
      const isNuclear = urlParams.get('nuclear') === 'true';
      const isDirect = urlParams.get('direct') === 'true';
      const isEmergency = urlParams.get('emergency') === 'true';
      const isClean = urlParams.get('clean') === 'true';
      
      if (isNuclear || isDirect || isEmergency || isClean) {
        console.log('üö® DETECTADA LIMPIEZA - Forzando URLs correctas');
        
        // Limpiar cualquier cache residual
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => caches.delete(name));
          });
        }
        
        // Forzar recarga de recursos con cache busting
        const timestamp = Date.now();
        window.location.search = '?v=' + timestamp + '&clean=true&force=' + timestamp;
      }
      
      // Interceptar todas las llamadas fetch para reemplazar localhost
      const originalFetch = window.fetch;
      window.fetch = function(url, options) {
        let modifiedUrl = url;
        
        // Si es una URL localhost, reemplazarla con la URL de producci√≥n
        if (typeof url === 'string' && url.includes('localhost:5001')) {
          modifiedUrl = url.replace('http://localhost:5001', 'https://tablero-control-1.onrender.com');
          console.log('üîÑ Interceptando fetch:', url, '‚Üí', modifiedUrl);
        }
        
        return originalFetch(modifiedUrl, options);
      };
      
      // Interceptar XMLHttpRequest tambi√©n
      const originalXHROpen = XMLHttpRequest.prototype.open;
      XMLHttpRequest.prototype.open = function(method, url, ...args) {
        let modifiedUrl = url;
        
        if (typeof url === 'string' && url.includes('localhost:5001')) {
          modifiedUrl = url.replace('http://localhost:5001', 'https://tablero-control-1.onrender.com');
          console.log('üîÑ Interceptando XHR:', url, '‚Üí', modifiedUrl);
        }
        
        return originalXHROpen.call(this, method, modifiedUrl, ...args);
      };
      
      // Forzar recarga de recursos est√°ticos con cache busting
      function forceReloadResources() {
        const timestamp = Date.now();
        const links = document.querySelectorAll('link[rel="stylesheet"]');
        const scripts = document.querySelectorAll('script[src]');
        
        links.forEach(link => {
          if (link.href && !link.href.includes('?v=')) {
            link.href = link.href + '?v=' + timestamp;
          }
        });
        
        scripts.forEach(script => {
          if (script.src && !script.src.includes('?v=')) {
            script.src = script.src + '?v=' + timestamp;
          }
        });
      }
      
      // Ejecutar cuando el DOM est√© listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', forceReloadResources);
      } else {
        forceReloadResources();
      }
    </script>
  </head>
  <body>
    <noscript>Necesitas habilitar JavaScript para ejecutar esta aplicaci√≥n.</noscript>
    <div id="root"></div>
  </body>
</html>
